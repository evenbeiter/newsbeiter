<!DOCTYPE html>
<html>
<head>
<link rel="manifest" href="manifest.json">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="뉴스베이터">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<title>News</title>
<style>
body {background-color:#F4ECD8;color:#3B2D20;font-size:1.4rem}
#container{min-height:100vh;max-width:600px;margin:auto}
.content{display:none;cursor:pointer}
.sepia{background-color:#F4ECD8;color:#3B2D20}
.sepia-contrast{background-color:#3B2D20;color:#F4ECD8}
h1,h2,h3,h4,h5,h6,.title{font-size:1.4rem;color:#3B2D20 !important;font-weight:bold}
a,figcaption{word-wrap:break-word;white-space:normal;overflow-wrap:break-word;word-break:break-word}
h1 a {color: navy; font-weight: bold; text-decoration:none;cursor:pointer}
.en-us{font-size:1.2rem}
.fs10, .time, figcaption{font-size:1rem}
img{display:block !important;margin:auto;width:100%;height:auto}
@media (min-width:768px){
  @font-face{font-family:"Microsoft JhengHei" !important;src:local("Microsoft JhengHei") !important;unicode-range:U+4E00-9FFF !important}
  body {background-color:#E5E4E2;color:#3B3B3B;font-size:1.2rem;font-family:arial,'Microsoft JhengHei', sans-serif !important}
  #container{min-height:100vh;max-width:600px;margin:auto;background-color:#F8F8F8}
  .sepia{background-color:#F8F8F8;color:#3B3B3B}
  .sepia-contrast{background-color:#3B3B3B;color:#F8F8F8}
  #list, .btn {font-weight:bold}
  h1,h2,h3,h4,h5,h6,.title{font-size:1.2rem;color:#3B3B3B !important;font-weight:bold}
}
</style>
</head>
<body>

<div id="container">
<div class="sticky-top position-fixed m-2 top-0 end-0" style="z-index:1030">
  <button type="button" class="btn btn-light position-relative sepia-contrast opacity-25" onclick="openOptions()">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-list" viewBox="0 0 16 16">
      <path fill-rule="evenodd" d="M2.5 12a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5m0-4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 0 1H3a.5.5 0 0 1-.5-.5"></path>
    </svg>
  </button>
  <br>
  <button type="button" class="btn btn-light mt-1 sepia-contrast opacity-25" onclick="ping()">
    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-bell" viewBox="0 0 16 16">
      <path d="M8 16a2 2 0 0 0 2-2H6a2 2 0 0 0 2 2M8 1.918l-.797.161A4 4 0 0 0 4 6c0 .628-.134 2.197-.459 3.742-.16.767-.376 1.566-.663 2.258h10.244c-.287-.692-.502-1.49-.663-2.258C12.134 8.197 12 6.628 12 6a4 4 0 0 0-3.203-3.92zM14.22 12c.223.447.481.801.78 1H1c.299-.199.557-.553.78-1C2.68 10.2 3 6.88 3 6c0-2.42 1.72-4.44 4.005-4.901a1 1 0 1 1 1.99 0A5 5 0 0 1 13 6c0 .88.32 4.2 1.22 6"></path>
    </svg>
</button>
</div>
<div id="top" class="fs10 py-2 sticky-top container-fluid justify-content-start overflow-auto sepia-contrast" style="display:none"></div>
<div id="search" class="py-2 sepia-contrast" style="display:none">
  <input type="text" id="search-term" class="form-control mb-2">
</div>
  <form id="btn-group" class="py-2 sticky-top container-fluid justify-content-start overflow-auto sepia-contrast" style="max-height:100vh">
    <div id="btn"></div>
  </form>
<div id="list" class="mx-3 pt-3"></div>
</div>

<script src="https://vjs.zencdn.net/7.20.3/video.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

<script>
const allSites=[['lineToday','LINE'],['anue','鉅亨'],['ctee','工商'],['wealth','財訊'],['businessToday','今周刊'],['businessWeekly','商周'],['msnTW','MSN 台灣'],['msnUS','MSN']];
const videoSites={'msn':[['WATCH','MSN'],['money video','Money'],['lifestyle video','Lifestyle'],['entertainment video','Entertainment']],'others':[['msnCnbcVideo','CNBC'],['wsjVideo','WSJ']]};
const uLi = ['ps','it','new','?','ap','sbe','rl','.','nd','h','fet','tt','on','er','re','=','co','m','/','i',':','ch','u'];
const searchSites=[['lineToday','LINE'],['anue','鉅亨'],['ctee','工商'],['businessToday','今周刊'],['cnbcVideo','CNBC']]; 
const iOd=[9,11,0,20,18,18,2,5,1,13,7,12,14,8,13,7,16,17,18,4,19,18,10,21,3,22,6,15];
const msnTW=[['Y_321db332-7d5a-4672-96b5-2d342ca554fb', '焦點'],['Y_ab001b84-62eb-4605-96c4-12221f946e94', '新聞'],['Y_5993abc4-f49c-49ce-bed0-a5b4b61dd9f6', '財經'],['Y_a484713e-0cec-4003-8fac-a629da5bcf3d', '兩岸國際'],['Y_a0268fb1-402c-48ec-8946-c31ddd7751da', '即時新聞'],['Y_b4ddc302-8189-44e9-b136-9682cc7e3746', '即時財經'],['Y_fef3ac37-3667-4a34-92c0-3e373c55d307', '理財'],['Y_aced43e9-95ab-4e5c-a0c5-d035aeb2133b', '科技'],['Y_da100b0d-55ac-49d4-beae-84ffdcbf3da9', '生活'],['Y_e2c684a5-a8fe-4879-91b9-8d5dc50b5488', '居家設計'],['Y_b77e5da5-aea6-4ee3-8890-91990040926a', '健康'],['Y_57552325-541f-4702-b61e-f307056e39b1', '旅遊'],['Y_95fdd1de-0e14-47b2-a213-6edf24542702', '娛樂'],['Y_f3ddd032-c606-4c7f-b11f-cb16a3596ae2', '台灣'],['Y_7a50bf00-ca7e-4699-ac07-b31e1c3ae01f', '房地產'],['Y_fb97b38c-1cf6-445a-b579-f7b9b35f6590', '職場求職'],['Y_54b11fc3-6cd6-45d6-a669-1c0168275125', '職場焦點'],
  ['vid-y9reuyeu7hkimpnrdtqpruibsfa4wd4bxxxip6dasjgrby33vd0a', '中央社'],['vid-08gw7ky4u229xjsjvnf4n6n7v67gxm0pjmv9fr4y2x9jjmwcri4s', '彭博'],['vid-hvwu6j8yi9b0huc8bkawy5qhvdf3scbniqc8scbbbp6xvj6ftrda', '商周'],['vid-rh9wrnpgtjfx7dbmc38h4xkf6j00me2e9amvgkeqtmanw40mw36s', '天下'],['vid-xj7qtb3g69dr6auu9p8ueq57gnarhrxd5ej05gtswdmnwi02xxia', '德國之聲'],['vid-jwkt4swyp9iyjy43f5cbhi02ttt8enb5t6yms0ppdx869vubmasa', '東森'],['vid-nvte086i8a39iuemvaxwsicfmc2j6tvixtcu9uxbfwqrgaw857rs', 'TVBS新聞'],['vid-n0sumxg56bwh3bguneg5ynixqc3qyiacjst3idsyus5rkrjs3pts', '中時'],['vid-e8mmyirx39xyms90cigfcgdn9p7vdy6u0xe243c7tdm2hgwiypas', '遠見'],['vid-9eqa8gpyscx8v293p3hsyxipqngqd3j7wexky6y09d7eye90m9ya', '風傳媒'],['vid-ctia0d3wuyutasjyriw3uvt8vaa0u4pmwkv0fqpgiciaf5r54m5a', '鏡週刊'],['vid-caqxm27w0p49tmy0ar5urvpar0ccx2b0xdaatyw2nxfqkgab7bds', '早安健康'],['vid-pui6vcpvju95tisme52646g2d79dvjt7akm8cg8ahmrbi8u7a2xa', '康健']];
const msnUS=[['Y_46b78bbb-31c4-4fc5-8a4a-858072348d06','News'],['Y_d1cad308-780e-4a75-ba34-6460811ccfe3','Tech'],['Y_99096e96-6d4f-401c-832b-461e08143a5a','Lifestyle'],
  ['Y_69fcfcf0-f686-4b19-9901-0a4ce35b823d', 'Business'],['Y_ce1fe19d-4d60-4312-b4d6-8cba9aa76413', 'Stocks'],['Y_8c7b0706-a0d1-49f1-8603-5c33a3dadd73', 'Economics'],['Y_d6433e0a-2be3-4106-839c-5a40a5375514', 'AI'],['Y_dc6dc645-d63a-4c97-8812-3ecdf27695b8', 'SMID'],['Y_f457eae0-84c0-4d35-b1dc-8435b7b6c140', 'Generative AI'],
  ['vid-08gw7ky4u229xjsjvnf4n6n7v67gxm0pjmv9fr4y2x9jjmwcri4s', 'Bloomberg'],['vid-mpxsw8rp392wedf25t8tfhk7r3b364q8dj75ks43nimmf06qg2es', 'Reuters'],['vid-r0r09b3muc6xnf5tv2est5f5ukjbkk67i9svrhyu3jy2pskkbems', 'MarketWatch'],['vid-y572a3ryyddhuiujs0xe2j4m4b6c3n2fp5hnux4jpsdand8h09ys', 'WSJ'],['vid-bpwfbvkfudq92wksju4upi9jrx2pn0ax46vrw0vkst93vpwr5pva', 'CNN'],['vid-v3atkpesfykfx7084fbu0cpbtx0jne99kctychfsn9ry96wsmbba', 'BBC'],['vid-r4du2vx0u9h0kr9tx7iyx55w7sneq7e6tg934epuehq3grvn05aa', 'Fortune'],['vid-n3h9ssyxg550pryvt4287xynyckhu84k5vc6n3tdqwsvtvmn2p0s', 'USA TODAY'],['vid-27xbtchrc5gpxe8uhvw9f24q2kqi9f0ppk7ptb8xw9v9sscheg6s', 'Motley Fool'],['vid-i3g0qyhrtn28biukcpyvsrmhccmv8k8ugtmtr6kqhb9dkf6ccrua', 'FOX News'],['vid-rvn4g4busxh65p6kgfvhye9atw9n8ebd46ut057ypkbm5n6xa5ts', 'BuzzFeed']];
const msnNewsVideo=[['vid-9sg538d8084xdac9cqur3c8fr7gyh8mehuf2f55ssbmcapc6hrha', 'CBS News - Video'],['vid-vvpqk5ypg9f3g4ypq6ahsrf0tu0bu56i7vh63n3tseid8uk4mkvs', 'The Washington Post - Video'],['Y_3446ecaf-77f7-4503-955f-f908510ac476', 'TikTok']];
const lineToday=[['top','焦點'],['finance','理財'],['100140','鉅亨'],['102394|103101','經濟工商'],['103214|100267','M平方'],['100295','今周刊'],['101131','CMoney'],['100422|100421|100423','商周'],['101170','路透社'],['104453|101006','財訊'],['100150|103088','鏡週刊'],['101427','CTWANT'],['100237','東森'],['100167','TVBS'],['100004|101886','風傳媒'],['100275|101201','關鍵評論網'],['global','國際'],['100003','中央社'],['TOPIC-USelection|2024election','川普2.0'],['worldtrend','世界趨勢'],['101074','CNN'],['tech','科技'],['AI','AI'],['100317','數位時代'],['100341','科技新報'],['101196','科技報橘'],['104322','優分析'],['104264','產業定錨筆記'],['100198','經理人月刊'],['101499','德國之聲'],['100462','換日線'],['100568|100158','天下雜誌'],['101031','地球圖輯隊'],['101934|100394','閱讀'],['domestic','國內'],['TOPIC-BingeWatching','追劇'],['TOPIC-KoreaStar','韓星最前線'],['health','健康'],['life','生活'],['cleanandstorage','生活智慧王'],['fun','鄉民'],['entertainment','娛樂'],['travel','旅遊'],['TOPIC-TravelJapan','日本旅遊情報']];
const yahooTW=[['cff206bf-9612-4903-9863-a9ad12319b12','焦點'],['b11aeba6-28c8-47bd-b0d8-96b89a20d817','即時'],['a8a208bf-23e1-4950-8aba-8a8d1c0c2da5','財經'],['f10835b8-98fe-48b4-a506-023937ab0a4b','Yahoo 特派'],['4e1fb4b1-9bf1-4d00-81a1-64001c935310','股匯市'],['cdbe8dd0-22d4-11ea-bbfb-7e2fb6871bd3','台股盤勢'],['9f0e62c0-22d5-11ea-bede-345eb8f1edf4','國際財經'],['e9628320-22d4-11ea-9ef0-2fabb53ab0e9','基金動態'],['381351b0-6d8c-11e9-bb53-0fc098ecd9a1','雜誌'],['ad05d340-22d5-11ea-9db1-fe39a6582c47','研究報告'],['70394000-22d5-11ea-bef4-114a94a8f820','小資理財'],['875b56b0-22d5-11ea-95cf-d43d8a1a8360','專家專欄'],['ebb0818f-c3e6-4c43-ab06-7fabe34c02f5','產業'],['65c6fa3b-b4c8-42e7-afed-c468a927d71f','國際'],['9336b431-7f5d-4dba-b06d-0dce56fb3f8f','娛樂'],['47409191-3f19-48a5-b99a-b7a19c5152f1','Yahoo'],['1af9d85f-9f45-4f07-a290-d6116fcd7e94','BBC'],['fbe20d0c-5704-4a52-a6dd-862b105734a8','中時'],['e9162370-a63f-41e1-b6ab-a2ca4bc88aa3','三立'],['841ae727-aaf4-4d96-89e8-6023380a5f0d','TVBS'],['d1c5195f-8c50-441f-8d4f-192505ff481a','公視'],['616c3db4-1af4-4d9a-90c2-e8d5b61fdca8','中天'],['24a219a6-e124-4d54-85c0-da53c42dad3f','聯合'],['1eeeee88-4e98-49f5-9283-d95b59faa8d0','東森'],['92e62bbd-f6b0-4ff2-ae60-da5e92602b8b','CWANT'],['15344921-beff-4849-8c1e-799f00eb6104','壹蘋'],['15fd91e7-7935-439f-a2a9-caea96a5c3db','鏡週刊'],['81870ef4-46f4-4ed2-a2b3-d436b9b85c06','NOWNews'],['80c8c637-4f0d-4df0-8c2e-d66523148f6d','台視'],['75f58300-9102-4339-a493-1e2f3e31313c','民視'],['f0caaf82-30b3-4e6c-a2eb-aa9577dbe7d4','華視'],['483b66c7-0238-411e-be93-53e1478272d3','新頭殻'],['71b213f3-88c4-41fe-b9f0-a59e9045e2d0','風傳媒'],['bd00c410-4b30-4245-abf8-d23656709efa__','Latest'],['db1d46e0-a969-11e9-bff5-6dfdb80d79cf__','Stock Market News'],['04d9350a-bbd1-4787-95be-740cc5ee8852__','Earnings'],['0897608a-7d79-47df-9377-b07bd22b0fde__','Yahoo Finance'],['ed5c8883-d951-4e70-87b3-9f8f375fb410__','Premium News'],['dffbd430-02a2-11e7-bcfc-437e9432ca73__','Tech'],['b1f0c990-db7a-11e7-a937-0d92c86f9da1__','Crypto']];
const anue=[['headline','頭條'],['tw_stock','台股'],['wd_stock','美股'],['tech','科技'],['fund','基金'],['tw_money','理財'],['forex','外匯'],['future','期貨'],['mag','雜誌'],['topics','專題'],['celebrity_area','新視界'],['bc','區塊鏈'],['cn_stock','陸港股'],['cnyeshouse','房產']];
const ctee=[['livenews/ctee/','即時'],['category/finance/','要聞'],['category/stock/','證券'],['category/finance/','金融'],['category/wealth/','理財'],['category/industry/','產業'],['category/house/','房市'],['category/world/','國際'],['category/view/','觀點'],['category/bookstore/','書房'],['category/lohas/','樂活']];
const wealth=[['','最新','Articles'],['bd088d2c-f76a-4187-8673-1ae412cd6356','謝金河','Articles'],['95f4329c-bcf4-47c4-b133-879bb862b479','財經茶水間','Category'],['2c6379e9-7527-442b-880a-bb9552689e06','國際','Category'],['87259978-8ff6-465c-b552-c33f69f6432e','投資理財','Category'],['450cbbed-c577-4d8e-a689-8e90b4f8bac7','財經指標','Category'],['d1354fa3-82bf-42e6-84ad-9e36d7615892','金融圈','Category'],['79c03f3f-d546-4551-a05f-c6d38e5579ca','科技','Category'],['3187845b-57fb-4336-bc4b-4f30cbeb642c','企業','Category'],['dd2b5859-96aa-42bb-b5cc-08e6c7c8728e','生醫','Category'],['800e2b3c-0352-4fba-aea2-01fff6b16015','地產','Category'],['352be1d4-7ce8-42b8-9a84-0f491f7927ea','政經','Category'],['de408237-667e-4594-abd8-8106ba567324','健康醫療','Category'],['2eb0f6be-d8bb-447d-b067-e17601f44056','美食旅遊','Category'],['2492cf34-afd8-40ee-95de-6f340988ab22','品味人生','Category']];
const businessToday=[['news/','最新'],['catalog/183007/list/page/','投資理財'],['catalog/183020/list/page/','保險稅制'],['catalog/183014/list/page/','產業時事'],['catalog/183028/list/page/','職場生活']];
const businessWeekly=[['0000000000','最新'],['0000000316','國際'],['0000000319','財經'],['0000000326','管理'],['0000000312','焦點'],['0000000342','CEO學院']];
const preStr=sCC(uLi,iOd);
var tabs=[];
var siteName='';
var coun='';
var t='';
var uuids='';
var payload={};
var rt=[];
var rr=0;
var options=document.getElementById('btn-group');
var search=document.getElementById('search');
var btn=document.getElementById('btn');
var list=document.getElementById('list');
var top=document.getElementById('top');

  
//    LANDING PAGE
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

ping();
openMediaList();

function createSearchEl(){
  tabs=searchSites;
  for (let tab of tabs){
    search.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="${tab[0]}Get1stSearchResults()">${tab[1]}</button>`;
  }
}

function showTop(t){
  top.innerText=t;
  top.style.display='block';
}
  
function openMediaList(){
  btn.innerHTML=`<button class="btn sepia me-1 mb-1" type="button" onclick="openMediaList()">總覽</button><button class="btn sepia me-1 mb-1" type="button" onclick="openSearchList()">搜尋</button><hr>`;
  tabs=allSites;
  for (let tab of tabs){
    btn.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="createBtnGroup(${tab[0]},'${tab[0]}')">${tab[1]}</button>`;
  }
  tabs=videoSites;
  btn.innerHTML+='<hr>';
  for (let tab of tabs.others){
    btn.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="${tab[0]}Get1stList('')">${tab[1]}</button>`;
  }
  btn.innerHTML+='<br>';
  for (let tab of tabs.msn){
    btn.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="msnVideoGet1stList('${tab[0]}')">${tab[1]}</button>`;
  }
  options.style.display='block';
  list.style.display='block';
  top.style.display='none';
}

function openSearchList(){
  if (isRunningAsPWA()) {
    search.style.display='block';
    options.style.display='none';
  list.style.display='none';
  top.style.display='none';
  createSearchEl();

  //document.getElementById('search-term').focus();
  //getUserInput();
  } else {
  btn.innerHTML=`<button class="btn sepia me-1 mb-1" type="button" onclick="openMediaList()">總覽</button><button class="btn sepia me-1 mb-1" type="button" onclick="openSearchList()">搜尋</button><hr><input type="text" id="search-term" class="form-control mb-2">`;
  tabs=searchSites;
  for (let tab of tabs){
    btn.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="${tab[0]}Get1stSearchResults()">${tab[1]}</button>`;
  }
  options.style.display='block';
  document.getElementById('top').style.display='none';
}
}

function isRunningAsPWA() {
  return window.matchMedia('(display-mode: standalone)').matches ||
         window.navigator.standalone === true;
}

function getUserInput() {
  if (isRunningAsPWA()) {
    // In iOS PWA – use prompt
    const input = prompt("Search text:");
    document.getElementById('search-term').value=input;
  } 
}

function openOptions(){
  var options=document.getElementById('btn-group');
    if (options.style.display=='none'){
    options.style.display='block';
  }else{options.style.display='none'}
}

async function ping(){
  var res=await fetch(preStr+'https://date.nager.at/api/v3/publicholidays/2025/US');
}

function createBtnGroup(site,siteName){
  btn.innerHTML=`<button class="btn sepia me-1 mb-1" type="button" onclick="openMediaList()">總覽</button><button class="btn sepia me-1 mb-1" type="button" onclick="openSearchList()">搜尋</button><hr>`;
  for (let tab of site){
    if (siteName!=='wealth'){
      btn.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="${siteName}Get1stList('${tab[0]}')">${tab[1]}</button>`;
    } else {
      btn.innerHTML+=`<button class="btn sepia me-1 mb-1" type="button" onclick="${siteName}Get1stList('${tab[2]}','${tab[0]}')">${tab[1]}</button>`;
    }
  }
    if (siteName!=='wealth'){
      window[`${siteName}Get1stList`](site[0][0]);
    } else {
      wealthGet1stList('Category','2c6379e9-7527-442b-880a-bb9552689e06')
    }
}


//    MSN
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

async function msnTWGet1stList(t){
rr=0;
msnGetList(t,'zh-tw');
showTop('MSN 台灣');
}

async function msnUSGet1stList(t){
rr=0;
msnGetList(t,'en-us');
showTop('MSN');
}

async function msnGetList(t,c){
siteName='msn';
coun=c;
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}

var items = [];
var url='';

if (t.slice(0,2)==='Y_'){
  var srvc='channelfeed';
  t='InterestIds='+t;
} else {
  var srvc='providerfullpage';
  t='CommunityProfileId='+t;
}

for (var i=0;i<2;i++){
  var url='https://assets.msn.com/service/news/feed/pages/'+srvc+'?ocid=social-peregrine&apikey=0QfOX3Vn51YCzitbLaRkTTBadtWpgTN8NZLW0C1SEM&User=m-00A80177A097658A10770F1FA15F64FF&cm='+coun+'&'+t+'&newsSkip='+12*((rr-1)*2+i)+'&$skip='+((rr-1)*2+i);
  let res=await fetch(url);
  let str=await res.json();
  for (let h of str.sections[0].cards){
    items.push([h.id,h.title]);
  }
}

    var html ='';
    for (let d of items){
      html+=`<p class="${coun} t-tl fw-bold" onclick="msnGetContent(this.id,'${d[0]}','${coun}')">${d[1]}</p><div id="${d[0]}" class="content ${coun}" onclick="msnGetContent(this.id,'${d[0]}','${coun}')"></div><hr>`;
    }
    document.getElementById('list').innerHTML+=html;

  if (coun==='en-us'){
    var all=document.querySelectorAll('.t-tl');
    for (let a of all){
      if (a.innerText!=='' && cnTest(a.innerText)!==true){
        var t=await translate(a.textContent);
        if (t!==''){a.outerHTML+='<p class="fs10">'+t+'</p>'};
      }
    }
  }
}

async function msnGetContent(clickedId,id,coun){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' && cEl.textContent!==''){cEl.style.display='block'}
  else if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    var res = await fetch('https://assets.msn.com/content/view/v2/Detail/'+coun+'/'+id);
    var d=await res.json();
        
    if (clickedId=='') {
      cEl.style.display='block';
      if (d.type==='article'){
        var nuxtDataItem = '<span class="fs10">'+(d.updatedDateTime?cvt2Timezone(d.updatedDateTime):'')+' | '+(d.provider.name ? d.provider.name:'')+'</span><br>' +(d.body?d.body:'')+ '<p class="text-end"><a href="' + (d.sourceHref ? d.sourceHref:'') + '" target="_blank">分享</a></p><br>';
        cEl.innerHTML=nuxtDataItem.replaceAll('\/>','\/><br>');
        var images=cEl.querySelectorAll('img');
        var imgSrc=d.imageResources;
        for (let img of images){
          img.src='https://img-s-msn-com.akamaized.net/tenant/amp/entityid/'+img.getAttribute('data-document-id').slice(18)+'.img';
        }
      } else if (d.type==='slideshow'){
          var slides=d.slides;
          var slidesHtml='';
          for (let s of slides){
            slidesHtml+='<img src="'+(s.image.url?s.image.url:'')+'"><br><p>'+(s.title?s.title:'')+'</p>'+(s.body?s.body:'');
          }
          var nuxtDataItem = '<span class="fs10">'+(d.updatedDateTime?cvt2Timezone(d.updatedDateTime):'')+' | '+(d.provider.name ? d.provider.name:'')+'</span><br>' +slidesHtml+ '<p class="text-end"><a href="' + (d.sourceHref ? d.sourceHref:'') + '" target="_blank">分享</a></p><br>';
          cEl.innerHTML=nuxtDataItem.replaceAll('\/>','\/><br>');

      }

  if (coun==='en-us'){
        var all=[];
        var pg=cEl.getElementsByTagName('p');all.push(...pg);
        var h2=cEl.getElementsByTagName('h2');all.push(...h2);
        var li=cEl.getElementsByTagName('li');all.push(...li);
        for (let a of all){
          if (a.innerText!=='' && cnTest(a.innerText)!==true){
            var t=await translate(a.textContent);
            if (t!==''){a.outerHTML+='<p class="fs10">'+t+'</p>'};
          }
        }
  }
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
} else {cEl.style.display='none';cEl.previousElementSibling.previousElementSibling.previousElementSibling.previousElementSibling.scrollIntoView()}
}


//    LINE TODAY
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function lineTodayGet1stList(tt){
rr=0;
lineTodayGetList(tt);
showTop('LINE TODAY');
}

async function lineTodayGetList(tt){
siteName='lineToday';
rt=tt;
if (rr==0){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
var items = [];
var url='';
tt=tt.split('|');
for (let t of tt) {
  if (/[0-9]/.test(t)){
    url=preStr+'https://today.line.me/webapi/trending/cp/latest/listings/module:cp:'+t+':5f4dd7e908b2af5b0e13bba1:0?offset='+rr*50+'&length=50&country=tw&targetContent=ALL&cps='+t+':200';
    let res=await fetch(url);
    let str=await res.json();
    for (let a of str.items){
      items.push(JSON.stringify([a.url.hash,a.publishTimeUnix,a.title]))
    }
  } else {
    url=preStr+'https://today.line.me/_next/data/v1/tw/v3/page/'+t+'.json';
    let res=await fetch(url);
    let str=await res.json();
    var data=str.pageProps.fallback['getPageData,'+t].modules;
    data=data.filter(d=>d.source=='LISTING');
    data=data.map(d=>d.listings[0].id);
    
    for (let d of data){
      res=await fetch(preStr+'https://today.line.me/api/v6/listings/'+d+'?country=tw&offset='+rr*20+'&length=20');
      str=await res.json();
      for (let a of str.items){
          items.push(JSON.stringify([a.url.hash,a.publishTimeUnix,a.title]))
      }
    } 
  }
}
items=[...new Set(items)];
items=items.map(i=>JSON.parse(i));
items=items.filter(i=>i[0]!==null && i[0]!=='');
items.sort((a, b) => {return Number(b[1]) - Number(a[1])});

var html ='';
for (let h of items){
  html+=`<p class="title" onclick="${siteName}GetContent(this.id,'${h[0]}')">${h[2]}</p><div id="${h[0]}" class="content" onclick="${siteName}GetContent(this.id,'${h[0]}')"></div><hr>`
}
if(html!==''){document.getElementById('list').innerHTML+=html;
rr++;}
}

async function lineTodayGetContent(clickedId,id){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    const res = await fetch(preStr+'https://today.line.me/webapi/portal/page/setting/article?country=tw&hash=' + id);
    const str=await res.json();
    const a = str.data;
    if (a) {
      if (a.media==undefined){
        var nuxtDataItem = '<span>' + a.publishTime + ' ' + a.publisher + '</span><br>' + a.content.replace(/img data-hashid="/g, 'img src="https://today-obs.line-scdn.net/') + '<p class="text-end"><a href="' + a.url.url + '" target="_blank">分享</a></p><br>';
      } else {
        var nuxtDataItem = '<span>' + a.publishTime + ' ' + a.publisher + '</span><br>' + '<video class="vjs-tech" style="width:100%" tabindex="-1" playsinline webkit-playsinline controls><source src="https://today-obs.line-scdn.net/'+a.media.hash+'/270p.m3u8" muted="muted" type="application/x-mpegURL"></source></video>' + a.content.replace(/img data-hashid="/g, 'img src="https://today-obs.line-scdn.net/') + '<p class="text-end"><a href="' + a.url.url + '" target="_blank">分享</a></p><br>';
      }
        cEl.innerHTML=nuxtDataItem;
        cEl.style.display='block';
    }
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}

async function lineTodayGet1stSearchResults(){
rr=0;
t=document.getElementById('search-term').value;
showTop('LINE TODAY - 搜尋：'+t);

siteName='lineToday';
document.getElementById('btn-group').style.display='none';
document.body.scrollTop = 0;
document.documentElement.scrollTop = 0;
var items = [];
var url='';
    url=preStr+'https://today.line.me/webapi/listing/search?country=tw&query='+t;
    let res=await fetch(url);
    let str=await res.json();
    for (let a of str.items){
      items.push(JSON.stringify([a.url.hash,a.publishTimeUnix,a.title,a.publisher]))
    }

items=[...new Set(items)];
items=items.map(i=>JSON.parse(i));
items=items.filter(i=>i[0]!==null && i[0]!=='');
items.sort((a, b) => {return Number(b[1]) - Number(a[1])});

var html ='';
for (let h of items){
  html+=`<p class="title" onclick="${siteName}GetContent(this.id,'${h[0]}')">${h[2]}<br><span class="fs10 fw-normal">${h[3]} | ${cvt2Timezone(h[1])}</span></p><div id="${h[0]}" class="content" onclick="${siteName}GetContent(this.id,'${h[0]}')"></div><hr>`
}
document.getElementById('list').innerHTML=html;
document.getElementById('search-term').value='';
search.style.display='none';
list.style.display='block';
}


//    YAHOO
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function yahooTWGet1stList(t){
rr=0;
yahooTWGetList(t);
showTop('YAHOO');
}

async function yahooTWGetList(t){
siteName='yahooTW';
var coun='TW';
if (t.slice(-2)=='__'){t=t.slice(0,-2);coun='US'};
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
var url=preStr+'https://ncp-gw-finance.media.yahoo.com/api/v2/gql/stream_view?count=200&imageFormat=WEBP&namespace=finance&ntkEnabled=false&ssl=true&id=neo-ntk-assetlist-stream&site=finance&version=v1&enableCrossModuleDedup=true&snippetCount=200&listId='+t;
let res=await fetch(url);
let str=await res.json();
var data=str.data.main.stream.slice((rr-1)*50,rr*50);
for (let h of data){
  if(h.content){
    h=h.content;
    items.push([h.canonicalUrl.url,h.title])
  }
}
var html='';
for (let h of items){
  html+=`<p class="title" onclick="yahooTWGetContent(this.id,'${h[0]}','${coun}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="yahooTWGetContent(this.id,'${h[0]}','${coun}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function yahooTWGetContent(clickedId,id,coun){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    const res = await fetch(preStr+id);
    const str=await res.text();
    var au=cEl.querySelector('.caas-attr-item-author');
    var t=cEl.querySelector('.caas-attr-time-style');
    var a=cEl.querySelector('.caas-body');
    
    var nuxtDataItem = '<p class="fs10">'+au.innerText+' | '+t.innerText+'</p>'+ a.outerHTML + '<p class="text-end"><a href="' + id + '" target="_blank">分享</a></p><br>';
    cEl.innerHTML=nuxtDataItem;

    var all=[...cEl.querySelectorAll('li'),...cEl.querySelectorAll('p')];
    for (let a of all){
      if (a.innerText!=='' && cnTest(a.innerText)!==true){
        var t=await translate(a.textContent);
        if (t!==''){a.outerHTML+='<p class="fs10">'+t+'</p>'};
      }
    }
    
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}


//    ANUE
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function anueGet1stList(t){
rr=0;
anueGetList(t);
showTop('鉅亨');
}

async function anueGetList(t){
siteName='anue';
rt=t;
rr++;
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}

  var html = '';
  var url='';
  if (t=='topics'){
      url=preStr+'https://api.cnyes.com/media/api/v1/project/index?page='+rr;
      let res=await fetch(url);
      let str=await res.json();
      for (let a of str.items.data){
        html+=`<p class="title" onclick="openUrl('${a.link}')">${a.title}</p><hr>`;
      }
    
  } else {
        url=preStr+'https://api.cnyes.com/media/api/v1/newslist/category/'+t+'?limit=30&page='+rr;
        let res=await fetch(url);
        let str=await res.json();
        for (let a of str.items.data){
          html+=`<p class="title" onclick="anueGetContent(this.id,'${a.newsId}')">${a.title}</p><div id="${a.newsId}" class="content" onclick="anueGetContent(this.id,'${a.newsId}')">
                <span class="time">${new Date(a.publishAt*1000)}</span><br>${decodeHTMLEntities(a.content)}<p class="text-end"><a href="https://news.cnyes.com/news/id/${a.newsId}" target="_blank">分享</a></p><br>
                </div><hr>`;
        }
      
    
  }
  document.getElementById('list').innerHTML+=html;
}
  
  function decodeHTMLEntities(str){
    var ta=document.createElement('textarea');
    ta.innerHTML = str;
    return ta.value;
  }

  async function anueGetContent(clickedId,id){
    var cEl=document.getElementById(id);
    if (cEl.style.display=='none' || cEl.style.display==''){
      cEl.style.display='block';
      if (id.length<5){
        const res = await fetch(preStr+id+',{mode: "no-cors"}');
        const str=await res.text();
        var parser = new DOMParser();
        var doc = parser.parseFromString(str, "text/html");
        var tagList=doc.querySelector('.scrolling');
        for (let c of tagList){
          cEl.innerHTML+=c.innerHTML
        }
      }
    } else {
        cEl.style.display='none';
        cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }

async function anueGet1stSearchResults(){
rr=0;
anueGetSearchResults();
showTop('鉅亨 - 搜尋：'+t);
document.getElementById('search-term').value='';
search.style.display='none';
list.style.display='block';
}

async function anueGetSearchResults(){
  rt='s';
  rr++;
  if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
  t=document.getElementById('search-term').value;
}
    var html = '';
    var url='';

      url=preStr+'https://api.cnyes.com/media/api/v1/search?q='+t+'&page='+rr;
      let res=await fetch(url);
      let str=await res.json();
      if(str.items.data!==null && str.items.data!==undefined){
      for (let a of str.items.data){
        html+=`<p class="title" onclick="anueGetSearchContent(this.id,'${a.newsId}')">${a.title.replaceAll('<mark>','').replaceAll('</mark>','')}</p><div id="${a.newsId}" class="content" onclick="anueGetSearchContent(this.id,'${a.newsId}')"><span class="time">${new Date(a.publishAt*1000)}</span><br><div id="content-${a.newsId}"></div><p class="text-end"><a href="https://news.cnyes.com/news/id/${a.newsId}" target="_blank">分享</a></p><br></div><hr>`;
      }
    }
    document.getElementById('list').innerHTML+=html;
    list.style.display='block';
  }

  async function anueGetSearchContent(clickedId,id){
    var cEl=document.getElementById(id);
    var contentEl=document.getElementById('content-'+id);
    if (cEl.style.display=='none' || cEl.style.display==''){
      cEl.style.display='block';
      let res=await fetch(preStr+'https://news.cnyes.com/news/id/'+id);
      let str=await res.text();
      var parser = new DOMParser();
      var doc = parser.parseFromString(str, "text/html");
      var a=doc.querySelector('#article-container');
      if(a){contentEl.innerHTML=a.outerHTML};
    } else {
        cEl.style.display='none';
        cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }

  function openUrl(url){
    window.open(url,'_blank')
  }


//    CTEE
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

async function cteeGet1stList(t){
rr=0;
cteeGetList(t);
showTop('工商');
}

async function cteeGetList(t){
siteName='ctee';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
var url='https://www.ctee.com.tw/api/'+t+rr;console.log(url);
let res=await fetch(url);
let str=await res.json();
for (let h of str){
  items.push([h.hyperLink,h.title,h.publishDatetime])
}
var html='';
for (let h of items){
  html+=`<p class="title" onclick="cteeGetContent(this.id,'${h[0]}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="cteeGetContent(this.id,'${h[0]}')"><p class="fs10">${cvt2Timezone(h[2])}</p></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function cteeGetContent(clickedId,id){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    const res = await fetch('https://www.ctee.com.tw/api'+id);
    const str=await res.json();
    if (cEl.innerText.length<30){
      var nuxtDataItem = str.contents + '<p class="text-end"><a href="https://www.ctee.com.tw' + id + '" target="_blank">分享</a></p><br>';
      cEl.innerHTML+=nuxtDataItem;
      cEl.querySelectorAll('img').forEach(img => {img.removeAttribute('style')});
    }
    cEl.style.display='block';
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}

async function cteeGet1stSearchResults(){
rr=0;
cteeGetSearchResults();
showTop('工商 - 搜尋：'+t);
document.getElementById('search-term').value='';
search.style.display='none';
list.style.display='block';
}

async function cteeGetSearchResults(){
  rt='s';
  rr++;
  var items=[];
  if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
  t=document.getElementById('search-term').value;
}
  var html = '';
  var url='';

  url='https://www.ctee.com.tw/api/search/'+t+'?p='+rr;
  let res=await fetch(url);
  let str=await res.json();
  for (let h of str){
    items.push([h.articleUrl,h.title,h.publishDate])
  }
  var html='';
  for (let h of items){
    html+=`<p class="title" onclick="cteeGetContent(this.id,'${h[0]}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="cteeGetContent(this.id,'${h[0]}')"><p class="fs10">${h[2]}</p></div><hr>`
  }
    document.getElementById('list').innerHTML+=html;
}
  

//    WEALTH
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  


async function wealthGet1stList(op,t){
rr=0;
wealthGetList(op,t);
showTop('財訊');
}

async function wealthGetList(op,t){
siteName='wealth';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}

if (op=='Articles'){
  payload={
    "operationName": "Articles",
    "variables": {
      "authorID": t,
      "offset": (rr-1)*50,
      "limit": 50,
      "type": "ARTICLE",
      "viewOrderType": null
    },
    "query": "query Articles($offset: Int, $limit: Int, $type: ArticleType, $vipOnly: Boolean, $searchTerm: String, $isFameColumn: Boolean, $magazineId: ID, $authorId: ID, $viewOrderType: ArticleViewOrderType) {\n  articles(\n    offset: $offset\n    limit: $limit\n    type: $type\n    vipOnly: $vipOnly\n    searchTerm: $searchTerm\n    isFameColumn: $isFameColumn\n    magazineId: $magazineId\n    authorId: $authorId\n    viewOrderType: $viewOrderType\n  ) {\n    ...ArticleBaseFields\n    __typename\n  }\n}\n\nfragment ArticleBaseFields on Article {\n  id\n  title\n  cover\n  coverText\n  content\n  authors {\n    name\n  }\n  releasedAt\n}\n"
  }
} else if (op=='Category'){
  payload={
    "operationName": "Category",
    "variables": {
      "id": t,
      "type": null,
      "offset": (rr-1)*50,
      "limit": 50,
      "viewOrderType": null
    },
    "query": "query Category($id: ID!, $offset: Int, $limit: Int, $type: ArticleType, $viewOrderType: ArticleViewOrderType) {\n  category(id: $id) {\n    id\n    name\n    articles(\n      offset: $offset\n      limit: $limit\n      type: $type\n      viewOrderType: $viewOrderType\n    ) {\n      ...ArticleBaseFields\n      __typename\n    }\n    __typename\n  }\n}\n\nfragment ArticleBaseFields on Article {\n  id\n  title\n  content\n}\n"
  }
} else if (op=='LatestMagazine'){
  payload={
    "operationName": "LatestMagazine",
    "variables": {},
    "query": "query LatestMagazine {\n  latestMagazine {\n    id\n    title\n  }\n}\n"
  }
}

var url='https://www.wealth.com.tw/graphql';
var res = await fetch(url, {
  method: 'POST',
  headers: {'Content-Type': 'application/json',},
  body: JSON.stringify(payload),
  });
var str=await res.json();

if (op=='Category'){var data=str.data.category.articles}else{var data=str.data.articles};
for (let h of data){
  items.push([h.id,h.title])
}
var html='';
for (let h of items){
  html+=`<p class="title" onclick="getContent(this.id,'${h[0]}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="getContent(this.id,'${h[0]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function getContent(clickedId,id){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';

    var payload={
      "operationName": "Article",
      "variables": {
        "id": id
      },
      "query": "query Article($id: ID!, $token: String) {\n  article(id: $id, token: $token) {\n    ...ArticleBaseFields\n  }\n}\n\nfragment ArticleBaseFields on Article {\n  id\n  title\n  cover\n  coverText\n  content\n  releasedAt\n  authors {\n    name\n  }\n}\n"
    };

    var url='https://www.wealth.com.tw/graphql';
    var res = await fetch(url, {
      method: 'POST',
      headers: {'Content-Type': 'application/json',},
      body: JSON.stringify(payload),
      });
    var str=await res.json();
    var data=str.data.article;
    var content=JSON.parse(str.data.article.content);

    var nuxtDataItem = '<p class="fs10">'+cvt2Timezone(data.releasedAt)+' | '+data.authors[0].name+'</p><img src="https://static.wealth.com.tw/'+data.cover+'"><p class="fs10">'+data.coverText+'</p><div id="'+id+'__"></div><p class="text-end"><a href="https://www.wealth.com.tw/articles/' + id + '" target="_blank">分享</a></p><br>';
    cEl.innerHTML=nuxtDataItem;
    var body='';    
    for (let c of content){console.log(c);
      if (c.type=='p'){
        body+='<p>';
        for (let a of c.children){if (a.type=='link'){body+='<a href="'+a.url+'">'+a.children[0].text+'</a>'} else {body+=a.text}};
        body+='</p>';
      } else if (c.type=='image_figure'){
        for (let a of c.children){
          if (a.type=='image'){body+='<img src="https://static.wealth.com.tw/'+a.src+'">'} else if (a.type=='image_caption'){body+='<p class="fs10">'+a.children[0].text+'</p>'}
        }
      }
    }
    document.getElementById(id+'__').innerHTML=body;
    
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}


//    BUSINESS TODAY
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

async function businessTodayGet1stList(t){
rr=0;
businessTodayGetList(t);
showTop('今周刊');
}

async function businessTodayGetList(t){
siteName='businessToday';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}

var url=preStr+'https://www.businesstoday.com.tw/'+t+rr;console.log(url);
var res = await fetch(url);
var str=await res.text();
var parser = new DOMParser();
var doc = parser.parseFromString(str, "text/html");
var hh=doc.querySelectorAll('a.article__item');
for (let h of hh){
  items.push([h.href,h.children[1].children[1].innerText])
}
var html='';
for (let h of items){
  html+=`<p class="title" onclick="businessTodayGetContent(this.id,'${h[0]}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="businessTodayGetContent(this.id,'${h[0]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function businessTodayGetContent(clickedId,id){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    const res = await fetch(preStr+id);
    const str=await res.text();
    var parser = new DOMParser();
    var doc = parser.parseFromString(str, "text/html");
    const img=doc.querySelector('.article__mainbanner');
    const t=doc.querySelector('.context__info-item--date');
    const au=doc.querySelector('.context__info-item--author');
    const a = doc.querySelector('.Zi_ad_ar_iR');

    if (a) {
      var nuxtDataItem = '<p class="fs10">'+t.innerText+' | '+au.innerText+'</p>'+a.outerHTML.replaceAll('<p>&nbsp;</p>','') + '<p class="text-end"><a href="' + id + '" target="_blank">分享</a></p><br>';
      cEl.innerHTML=nuxtDataItem;
      var ads=cEl.querySelectorAll('iframe');
      for (let ad of ads){ad.remove()};
      cEl.style.display='block';
    }
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}

async function businessTodayGet1stSearchResults(){
rr=0;
businessTodayGetSearchResults();
showTop('今周刊 - 搜尋：'+t);
document.getElementById('search-term').value='';
}

async function businessTodayGetSearchResults(){
  rt='s';
  rr++;
  var items=[];
  if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
  t=document.getElementById('search-term').value;
}
  var html = '';
  var url='';

url=preStr+'https://www.businesstoday.com.tw/group_search/article?count=30&keywords='+t+'&page='+rr;console.log(url);
var res = await fetch(url);
var str=await res.text();
var parser = new DOMParser();
var doc = parser.parseFromString(str, "text/html");
var hh=doc.querySelectorAll('.searchitem__content');
for (let h of hh){
  var href=hh[0].children[1].children[0].href;
  href= href.slice(0,href.indexOf('?'));
  items.push([href,h.children[1].innerText])
}
  var html='';
  for (let h of items){
    html+=`<p class="title" onclick="businessTodayGetContent(this.id,'${h[0]}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="businessTodayGetContent(this.id,'${h[0]}')"></div><hr>`
  }
    document.getElementById('list').innerHTML+=html;
}


//    BUSINESS WEEKLY
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

async function businessWeeklyGet1stList(t){
rr=0;
businessWeeklyGetList(t);
showTop('商業周刊');
}

async function businessWeeklyGetList(t){
siteName='businessWeekly';
rr++;
rt=t;
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}

var items = [];
if (t=='0000000000'){
  var res = await fetch(preStr+'https://www.businessweekly.com.tw/latest/SearchList', {
    method: 'POST',
    headers: {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',},
    body: 'CurPage='+20*(rr-1),
    });
  
  var str=await res.json();
  str=str.Content;

} else {

var res = await fetch(preStr+'https://www.businessweekly.com.tw/ChannelAction/LoadBlock/', {
  method: 'POST',
  headers: {'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',},
  body: 'Start='+(50*rr-1)+'&End='+50*(rr)+'&ID='+t,
  });

var str=await res.text();
}
var parser = new DOMParser();
var doc = parser.parseFromString(str, "text/html");
var titles=doc.querySelectorAll('.Article-content a');
for (let tl of titles){
  items.push([tl.href,tl.textContent.replace('                    ','')]);
}

var html='';
for (let h of items){
  html+=`<p class="title" onclick="businessWeeklyGetContent(this.id,'${h[0]}')">${h[1]}</p><div id="${h[0]}" class="content" onclick="businessWeeklyGetContent(this.id,'${h[0]}')"></div><hr>`
}
console.log(items);
document.getElementById('list').innerHTML+=html;
}

async function businessWeeklyGetContent(clickedId,id){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    const res = await fetch((preStr+id).replace('evenbeiter.github.io','www.businessweekly.com.tw'));
    const str=await res.text();
    var parser = new DOMParser();
    var doc = parser.parseFromString(str, "text/html");
    const p=doc.querySelectorAll('.Border-right')[1] ?? '';
    const t=doc.querySelector('#AppGetDate') ?? '';
    const s=doc.querySelector('.Single-summary') ?? '';  
    const a=doc.querySelector('.Single-article') ?? '';
    a.querySelectorAll('.Google-special').forEach(e => e.remove());
    if (a) {
        var nuxtDataItem = '<p class="fs10">'+(p.textContent ?? '')+' '+(t.textContent ?? '')+'</p>'+(s.outerHTML ?? '')+(a.outerHTML ?? '')+ '<p class="text-end"><a href="'+id+'" target="_blank">分享</a></p><br>';
        cEl.innerHTML=nuxtDataItem;
        cEl.style.display='block';
    }
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){cEl.style.display='none';
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}
  
  
//    CNBC VIDEO FROM MSN
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function msnCnbcVideoGet1stList(){
rr=0;
msnCnbcVideoGetList(t);
showTop('CNBC Video');
}

async function msnCnbcVideoGetList(){
siteName='msnCnbcVideo';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
for (var i=0;i<2;i++){
  var url='https://assets.msn.com/service/news/feed/pages/providerfullpage?market=en-us&timeOut=10000&ocid=finance-data-feeds&apikey=0QfOX3Vn51YCzitbLaRkTTBadtWpgTN8NZLW0C1SEM&CommunityProfileId=vid-4k3nj4ageev4xbh5ka3xq2xv0au7qyya0p2bt0w8tvx9u0x895rs&cm=en-us&User=m-00A80177A097658A10770F1FA15F64FF&newsSkip='+12*((rr-1)*2+i)+'&query=newest&$skip='+((rr-1)*2+i);
  let res=await fetch(url);
  let str=await res.json();
  for (let h of str.sections[0].cards){
    if(h.type=='video'){
      items.push([h.id,h.title,h.publishedDateTime,h.videoMetadata.playTime,h.images[0].url,h.url,h.externalVideoFiles[1].url]);
    }
  }
}
items.sort((a, b) => {return Number(new Date(b[2]).getTime()) - Number(new Date(a[2]).getTime())});

var html='';
for (let h of items){
  html+=`<div onclick="msnCnbcVideoGetContent(this.id,'${h[0]}','${h[5]}','${h[6]}')"><img src="${h[4]}" class="pb-2"><span class="title">${h[1]}</span><br><span class="fs10">${cvt2Timezone(h[2])} | </span><span class="fs10 fw-bold">${cvtS2HHMMSS(h[3],1)}</span></div><div id="${h[0]}" class="content" onclick="msnCnbcVideoGetContent(this.id,'${h[0]}','${h[5]}','${h[6]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function msnCnbcVideoGetContent(clickedId,id,url,m3u8Url){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    var nuxtDataItem = '<video id="video-'+id+'" class="video-js" style="width:100%;height:auto" playsinline controls></video>'+'<p class="text-end"><a href="' + url + '" target="_blank">Share</a></p><br>';
    cEl.innerHTML=nuxtDataItem;

    const video = document.getElementById('video-'+id);

    if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = m3u8Url;
        video.play();
    } else if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(m3u8Url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play();
        });
    } else {
        console.error("HLS is not supported in this browser.");
    }

    document.getElementById('video-'+id).parentElement.previousElementSibling.firstChild.setAttribute('style', 'display: none !important;');
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){
      cEl.style.display='none';
      cEl.previousElementSibling.firstChild.setAttribute('style', 'display: block !important;');
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}
  

//    CNBC VIDEO
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function cnbcVideoGetList(t){
var t='100004038';
siteName='cnbcVideo';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
var url='https://webql-redesign.cnbcfm.com/graphql?operationName=getAssetList&variables={"id":"'+t+'","offset":'+(rr-1)*30+',"pageSize":30,"nonFilter":false,"includeNative":true,"include":[]}&extensions={"persistedQuery":{"version":1,"sha256Hash":"43ed5bcff58371b2637d1f860e593e2b56295195169a5e46209ba0abb85288b7"}}';console.log(url);

let res=await fetch(url);
let str=await res.json();
for (let h of str.data.assetList.assets){
  items.push([h.url,h.title,h.datePublished,h.duration,h.promoImage.url])
}
var html='';
for (let h of items){
  html+=`<div onclick="cnbcVideoGetContent(this.id,'${h[0]}')"><img src="${h[4]}" class="pb-2"><span class="title">${h[1]}</span><br><span class="fs10">${cvt2Timezone(h[2])} | </span><span class="fs10 fw-bold">${cvtS2HHMMSS(h[3],1)}</span></div><div id="${h[0]}" class="content" onclick="cnbcVideoGetContent(this.id,'${h[0]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function cnbcVideoGetContent(clickedId,id){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    const res = await fetch(preStr+id);
    const str=await res.text();
    var videoSrc=str.match(/"playbackURL":"[\s\S]*?.m3u8/g)[0].replace('"playbackURL":"','');
    var m3u8Url='https:'+JSON.parse(`"${videoSrc}"`);console.log(m3u8Url);
    var des=str.match(/"description":"[\s\S]*?"/g)[0].replace('"description":"','');
    
    videoSrc=str.match(/"playbackURL":"[\s\S]*?.m3u8/g)[0].replace('"playbackURL":"','');
    var nuxtDataItem = '<video id="video-'+id+'" class="video-js" style="width:100%;height:auto" playsinline controls></video>'+'<p class="text-end"><a href="' + id + '" target="_blank">Share</a></p><br>';
    cEl.innerHTML=nuxtDataItem;
    cEl.previousElementSibling.firstChild.setAttribute('style', 'display: none !important;');
    var video=document.getElementById('video-'+id); 
      
    if (video.canPlayType('application/vnd.apple.mpegurl')) {
          video.src = m3u8Url;
          video.play();
    } else if (Hls.isSupported()) {
      const hls = new Hls();
      hls.loadSource(m3u8Url);
      hls.attachMedia(video);
      hls.on(Hls.Events.MANIFEST_PARSED, () => {
          video.play();
      });
    }      
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){
      cEl.style.display='none';
      cEl.previousElementSibling.firstChild.setAttribute('style', 'display: block !important;');
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}

async function cnbcVideoGet1stSearchResults(){
rr=0;
cnbcVideoGetSearchResults();
}

async function cnbcVideoGetSearchResults(){
  siteName='cnbcVideo';
  rt='s';
  rr++;
  var items=[];
  if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
  t=document.getElementById('search-term').value;
}
  var html = '';
  var url='';

  url='https://api.queryly.com/cnbc/json.aspx?queryly_key=31a35d40a9a64ab3&callback=&showfaceted=false&timezoneoffset=-480&facetedfields=formats&facetedkey=formats|&facetedvalue=Video|&needtoptickers=0&additionalindexes=4cd6f71fbf22424d,937d600b0d0d4e23,3bfbe40caee7443e,626fdfcd96444f28&query='+'100004038'+'&endindex='+(rr-1)*30+'&batchsize=30&sort=';
  let res=await fetch(url);
  let str=await res.json();
  for (let h of str.results){
    items.push([h.url,h['cn:title'],h._pubDate,h.duration,h['cn:promoImage']])
  }
  var html='';
  for (let h of items){
    html+=`<div onclick="cnbcVideoGetContent(this.id,'${h[0]}')"><img src="${h[4]}" class="pb-2"><span class="title">${h[1]}</span><br><span class="fs10">${h[2]} | </span><span class="fs10 fw-bold">${cvtS2HHMMSS(h[3],1)}</span></div><div id="${h[0]}" class="content" onclick="cnbcVideoGetContent(this.id,'${h[0]}')"></div><hr>`
  }
  document.getElementById('list').innerHTML+=html;
}


//    YAHOO VIDEO
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function yahooVideoGet1stList(t){
var t='00390a14-17cc-49d2-9e32-79365335f0ca';
rr=0;
uuids='';
yahooVideoGetList(t);
showTop('Yahoo Video');
}

async function yahooVideoGetList(t){
siteName='yahooVideo';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
  uuids='paginationString={}';
}

var payload={
  "payload":{
    "gqlVariables": {
        "main": {
            "pagination": {
                "uuids": uuids
            }
        }
    }
},
  "serviceConfig": {
    "listId": t,
    "count": 200,
    "snippetCount": 50
  }
};
var url='https://finance.yahoo.com/xhr/ncp?location=US&queryRef=videosCategoryNeo&serviceKey=ncp_fin&lang=en-US&region=US';
var res = await fetch(url, {
  method: 'POST',
  headers: {'Content-Type': 'text/plain;charset=UTF-8',},
  body: JSON.stringify(payload),
  });
var str=await res.json();
uuids=str.data.main.pagination.uudis;

for (let h of str.data.main.stream){
  items.push([h.id,h.content.title,h.content.pubDate,h.content.duration,h.content.thumbnail.originalUrl,h.content.canonicalUrl.url])
}

var html='';
for (let h of items){
  html+=`<div onclick="yahooVideoGetContent(this.id,'${h[0]}','${h[5]}')"><img src="${h[4]}" class="pb-2"><span class="title">${h[1]}</span><br><span class="fs10">${cvt2Timezone(h[2])} | </span><span class="fs10 fw-bold">${cvtS2HHMMSS(h[3],1)}</span></div><div id="${h[0]}" class="content" onclick="yahooVideoGetContent(this.id,'${h[0]}','\${h[5]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function yahooVideoGetContent(clickedId,id,url){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    var nuxtDataItem = '<iframe id="video-'+id+'" src="'+url+'?format=embed" style="width:100%;height:auto"></iframe>'+'<p class="text-end"><a href="' + url + '" target="_blank">Share</a></p><br>';
    cEl.innerHTML=nuxtDataItem;

    document.getElementById('video-'+id).parentElement.previousElementSibling.firstChild.setAttribute('style', 'display: none !important;');
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){
      cEl.style.display='none';
      cEl.previousElementSibling.firstChild.setAttribute('style', 'display: block !important;');
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}


//    MSN VIDEO
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function msnVideoGet1stList(t){
rr=0;
msnVideoGetList(t);
var cat=t.split(' ')[0];
cat=cat.charAt(0).toUpperCase() + cat.slice(1);
showTop('MSN '+cat);
}

async function msnVideoGetList(t){
siteName='msnVideo';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
var url='https://assets.msn.com/service/MSN/Feed/me?apikey=0QfOX3Vn51YCzitbLaRkTTBadtWpgTN8NZLW0C1SEM&cm=en-us&contentType=video&query='+t+'&queryType=myfeed&$top=50&$skip='+(rr-1)*50;
let res=await fetch(url);
let str=await res.json();
for (let h of str.value[0].subCards){
  items.push([h.sourceId,h.title,h.publishedDateTime,h.videoMetadata.playTime,h.images[0].url,h.url,h.externalVideoFiles[1].url,h.provider.name]);
}
items.sort((a, b) => {return Number(new Date(b[2]).getTime()) - Number(new Date(a[2]).getTime())});

var html='';
for (let h of items){
  html+=`<div onclick="msnVideoGetContent(this.id,'${h[0]}','${h[5]}','${h[6]}')"><img src="${h[4]}" class="pb-2"><span class="title">${h[1]}</span><br><span class="fs10">${h[7]}<br>${cvt2Timezone(h[2])} | </span><span class="fs10 fw-bold">${cvtS2HHMMSS(h[3],1)}</span></div><div id="${h[0]}" class="content" onclick="msnVideoGetContent(this.id,'${h[0]}','${h[5]}','${h[6]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function msnVideoGetContent(clickedId,id,url,m3u8Url){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    var nuxtDataItem = '<video id="video-'+id+'" class="video-js" style="width:100%;height:auto" playsinline controls></video>'+'<p class="text-end"><a href="' + url + '" target="_blank">Share</a></p><br>';
    cEl.innerHTML=nuxtDataItem;

    const video = document.getElementById('video-'+id);

    if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = m3u8Url;
        video.play();
    } else if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(m3u8Url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play();
        });
    } else {
        console.error("HLS is not supported in this browser.");
    }

    document.getElementById('video-'+id).parentElement.previousElementSibling.firstChild.setAttribute('style', 'display: none !important;');
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){
      cEl.style.display='none';
      cEl.previousElementSibling.firstChild.setAttribute('style', 'display: block !important;');
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}


//    WSJ VIDEO
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
  
async function wsjVideoGet1stList(t){
rr=0;
wsjVideoGetList(t);
showTop('WSJ Video');
}

async function wsjVideoGetList(t){
siteName='wsjVideo';
var items = [];
rr++;
rt=t;
console.log(rr);
if (rr==1){
  document.getElementById('btn-group').style.display='none';
  document.body.scrollTop = 0;
  document.documentElement.scrollTop = 0;
  document.getElementById('list').innerHTML='';
}
var url='https://video-api.shdsvc.dowjones.io/api/legacy/find-all-videos?lang=en-us&count=50'+t+'&page='+(rr-1);
let res=await fetch(url);
let str=await res.json();
for (let h of str.items){
  var thumbnail=h.thumbnailList[0].url;
  items.push([h.id.replace('{','').replace('}',''),h.name,h.formattedCreationDate,h.duration,thumbnail.slice(0,thumbnail.indexOf('?')),h.linkURL,h.hls])
}
items.sort((a, b) => {return Number(new Date(b[2]).getTime()) - Number(new Date(a[2]).getTime())});

var html='';
for (let h of items){
  html+=`<div onclick="wsjVideoGetContent(this.id,'${h[0]}','${h[5]}','${h[6]}')"><img src="${h[4]}" class="pb-2"><span class="title">${h[1]}</span><br><span class="fs10">${cvt2Timezone(h[2])} | </span><span class="fs10 fw-bold">${cvtS2HHMMSS(h[3],1)}</span></div><div id="${h[0]}" class="content" onclick="wsjVideoGetContent(this.id,'${h[0]}','${h[5]}','${h[6]}')"></div><hr>`
}
document.getElementById('list').innerHTML+=html;
}

async function wsjVideoGetContent(clickedId,id,url,hls){
  var cEl=document.getElementById(id);
  if (cEl.style.display=='none' || cEl.style.display==''){
    cEl.style.display='block';
    var nuxtDataItem = '<video id="video-'+id+'" class="video-js" style="width:100%;height:auto" playsinline controls></video>'+'<p class="text-end"><a href="' + url + '" target="_blank">Share</a></p><br>';
    cEl.innerHTML=nuxtDataItem;

    const video = document.getElementById('video-'+id);
    const m3u8Url = hls;

    if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = m3u8Url;
        video.play();
    } else if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(m3u8Url);
        hls.attachMedia(video);
        hls.on(Hls.Events.MANIFEST_PARSED, () => {
            video.play();
        });
    } else {
        console.error("HLS is not supported in this browser.");
    }

    document.getElementById('video-'+id).parentElement.previousElementSibling.firstChild.setAttribute('style', 'display: none !important;');
  } else {
    if (clickedId=='' || cEl.innerHTML.indexOf('<video')==-1){
      cEl.style.display='none';
      cEl.previousElementSibling.firstChild.setAttribute('style', 'display: block !important;');
      cEl.previousElementSibling.previousElementSibling.scrollIntoView()
    }
  }
}


//    GLOBAL FUNCTIONS
/////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

function cvtS2HHMMSS(sec,rescale) {
    s = Math.max(0, Math.floor(sec/rescale));
    const hours = Math.floor(s / 3600);
    const minutes = Math.floor((s % 3600) / 60);
    const remainingSeconds = s % 60;
    const mm = String(minutes).padStart(2, '0');
    const ss = String(remainingSeconds).padStart(2, '0');
    if (hours > 0) {
        const hh = String(hours).padStart(2, '0');
        return hh+':'+mm+':'+ss;
    }
    return mm+':'+ss;
}
  
function cvtTime(unixTimestamp) {
  const date = new Date(unixTimestamp);
  const year = date.getFullYear();
  const month = String(date.getMonth() + 1).padStart(2, '0');
  const day = String(date.getDate()).padStart(2, '0');
  return `${year}-${month}-${day}`;
}

function cvt2Timezone(timestamp) {
    const date = new Date(timestamp);
    return date.toLocaleString();
}

function sCC(a,ii){
  let result='';
  for (const i of ii){
    if (i>=0 && i<a.length){result+=a[i]}
  }
  return result;
}

async function translate(a){
  try{
    var url = 'https://translate.googleapis.com/translate_a/single?client=gtx&dt=t&sl=auto&tl=zh-TW&q='+encodeURIComponent(a);
    var res=await fetch(url);
    var raw=await res.json();
    var ts='';
    for (var j=0;j<raw[0].length;j++){
        if (raw[0][j][0]!==null && raw[0][j][0]!==undefined && raw[0][j][0]!=='undefined'){ts=ts+raw[0][j][0]}else{ts=ts}
    }
    return ts
  }catch (error) {console.error(error)}
}

function cnTest(str) {
  const chineseCharRegex = /[\u4E00-\u9FFF\u3400-\u4DBF\uF900-\uFAFF]/;
  return chineseCharRegex.test(str);
}
  
let scrollTimeout;
window.onscroll = function () {
  clearTimeout(scrollTimeout);
  scrollTimeout = setTimeout(() => {
    const scrollTop = window.scrollY;
    const windowHeight = window.innerHeight;
    const documentHeight = document.documentElement.scrollHeight;
    if (scrollTop + windowHeight >= documentHeight - 5) {
      if(rt!=='s'){
        if (typeof window[`${siteName}GetList`] === "function") {
          if (siteName!=='msn'){
            window[`${siteName}GetList`](rt)
          } else {
            window[`${siteName}GetList`](rt,coun)
          }
        }
      }else{
        if (typeof window[`${siteName}GetSearchResults`] === "function") {window[`${siteName}GetSearchResults`]()}
      }
    }
  }, 1000);
};
  
</script>
</body>
</html>
