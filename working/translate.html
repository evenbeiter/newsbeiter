<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Email Translator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
    }
    #drop-zone {
      border: 2px dashed #6c757d;
      border-radius: 10px;
      padding: 40px;
      text-align: center;
      color: #6c757d;
      background: white;
      cursor: pointer;
      margin-bottom: 20px;
    }
    #drop-zone.dragover {
      border-color: #0d6efd;
      color: #0d6efd;
      background: #e9f5ff;
    }
    .translation-block {
      margin-top: 20px;
    }
    .en-text {
      font-weight: 500;
      color: #212529;
    }
    .zh-text {
      color: #495057;
      margin-bottom: 1rem;
    }
  </style>
</head>
<body>
  <div class="container d-flex vh-100">
    <div class="row justify-content-center align-self-center w-100">
      <div class="col-md-8">
        <!-- 拖曳 / 點擊上傳 -->
        <div id="drop-zone">
          <h5>📩 拖曳或點擊上傳郵件檔 (.eml / .msg)</h5>
          <input type="file" id="fileInput" accept=".eml,.msg" hidden>
          <p class="small">或直接在下方貼上郵件內容</p>
        </div>
        <!-- 貼上文字區 -->
        <textarea id="paste-area" class="form-control" rows="6" 
          placeholder="在這裡貼上郵件內容"></textarea>
        <button id="translateBtn" class="btn btn-primary mt-2">翻譯貼上內容</button>

        <!-- 翻譯結果 -->
        <div id="output" class="translation-block"></div>
      </div>
    </div>
  </div>

  <script>
    // 模擬翻譯函數，這裡假設你已經有 translateToChinese()
    function translateToChinese(text) {
      return "【中文翻譯】" + text; // TODO: 換成你的翻譯邏輯
    }

    const dropZone = document.getElementById('drop-zone');
    const fileInput = document.getElementById('fileInput');
    const output = document.getElementById('output');
    const pasteArea = document.getElementById('paste-area');
    const translateBtn = document.getElementById('translateBtn');

    // 防止預設行為 (避免打開檔案)
    ['dragenter','dragover','dragleave','drop'].forEach(eventName => {
      dropZone.addEventListener(eventName, e => e.preventDefault());
      document.body.addEventListener(eventName, e => e.preventDefault());
    });

    // 拖曳效果
    dropZone.addEventListener('dragover', () => dropZone.classList.add('dragover'));
    dropZone.addEventListener('dragleave', () => dropZone.classList.remove('dragover'));

    // 拖曳檔案進來
    dropZone.addEventListener('drop', e => {
      dropZone.classList.remove('dragover');
      handleFile(e.dataTransfer.files[0]);
    });

    // 點擊選檔
    dropZone.addEventListener('click', () => fileInput.click());
    fileInput.addEventListener('change', e => {
      if (e.target.files[0]) handleFile(e.target.files[0]);
    });

    // 處理檔案
    function handleFile(file) {
      const reader = new FileReader();
      reader.onload = () => {
        processText(reader.result);
      };
      reader.readAsText(file);
    }

    // 翻譯貼上的內容
    translateBtn.addEventListener('click', () => {
      const text = pasteArea.value.trim();
      if (text) processText(text);
    });

    // 顯示翻譯結果
    function processText(text) {
      const paragraphs = text.split(/\r?\n\r?\n/);
      output.innerHTML = "";
      paragraphs.forEach(p => {
        if (p.trim() === "") return;
        const enDiv = document.createElement("div");
        enDiv.className = "en-text";
        enDiv.textContent = p.trim();

        const zhDiv = document.createElement("div");
        zhDiv.className = "zh-text";
        zhDiv.textContent = translateToChinese(p.trim());

        output.appendChild(enDiv);
        output.appendChild(zhDiv);
      });
    }
  </script>
</body>
</html>